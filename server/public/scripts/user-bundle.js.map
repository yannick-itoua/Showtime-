{"version":3,"file":"scripts/user-bundle.js","mappings":"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","sources":["webpack://showtime client/./src/scripts/user.js"],"sourcesContent":["//user.js\r\nconst socket = io();\r\nconst contentDiv = document.getElementById('content');\r\nconst listDiv = document.getElementById('list');\r\nconst userDiv=document.getElementById('userId');\r\nconst log=document.getElementById('logout');\r\nconst borrowedItemDiv = document.getElementById('borrowed-item');\r\n\r\nconst displayItems = async () => {\r\n    const requestOptions = {\r\n      method: 'GET'\r\n    };\r\n    const response = await fetch('/item/', requestOptions);\r\n    if (!response.ok) {\r\n      throw new Error('Response not ok');\r\n    }\r\n    const items = await response.json();\r\n    let html = '<p>Les spectacles:</p><ul>';\r\n    items.forEach(item => {\r\n      html += `<li class=\"item\">${item.description} : ${item.capacity} places  <button class=\"emprunt\" data-id=\"${item._id}\">Réserver un ticket</button></li>`;\r\n    });\r\n    listDiv.innerHTML = html;\r\n\r\n    const borrowButtons = document.querySelectorAll('.emprunt');\r\n    borrowButtons.forEach(button => {\r\n      button.addEventListener('click', () => {\r\n        const itemId = button.getAttribute('data-id');\r\n        borrowItem(itemId, button);\r\n      });\r\n    });\r\n};\r\n\r\nconst borrowItem = async (itemId, button) => {\r\n  const requestOptions = {\r\n    method: 'PUT'\r\n  };\r\n  const response = await fetch(`/user/borrow/${itemId}`, requestOptions);\r\n  const item = await response.json();\r\n\r\n  const user = await getUser();\r\n  \r\n  const ticket = user.tickets.find(ticket => ticket.item.toString() === itemId);\r\n  const reservedTickets = ticket ? ticket.reservedTickets : 0;\r\n  if (item.capacity - reservedTickets <= 0) {\r\n    button.disabled = true;\r\n    contentDiv.textContent = 'No more place';\r\n    displayItems();\r\n    socket.emit('capacityZero', itemId);\r\n    return;\r\n  }\r\n  contentDiv.textContent = `Spectacle avec id ${itemId} est réservé. `;\r\n  button.parentNode.remove();\r\n  displayItems();\r\n  socket.emit('itemBorrowed',itemId);\r\n};\r\n\r\nconst releaseItem = async (itemId, button) => {\r\n  const requestOptions = {\r\n    method: 'PUT'\r\n  };\r\n  const response = await fetch(`/user/release/${itemId}`, requestOptions);\r\n  if (!response.ok) {\r\n    throw new Error(`Failed to release item with id ${itemId}.`);\r\n  }\r\n  socket.emit('itemReleased',itemId);\r\n  const item = await response.json(); \r\n  const user = await getUser();\r\n  if (!user) {\r\n    console.error('User not found.');\r\n    return;\r\n  }\r\n  const ticket = user.tickets.find(ticket => ticket.item.toString() === itemId);\r\n  const reservedTickets = ticket ? ticket.reservedTickets : 0;\r\n  if (reservedTickets <= 0) {\r\n    console.error('No tickets to release.');\r\n    return;\r\n  }\r\n  contentDiv.textContent = `Spectacle avec id ${itemId} est libéré. `;\r\n  const listItem = borrowedItemDiv.querySelector(`li[data-id=\\\"${itemId}\\\"]`);\r\n  \r\n  if (reservedTickets - 1 <= 0) {\r\n    listItem.remove();\r\n  } else {\r\n    listItem.innerHTML = `${item.description || 'Description non disponible'} : ${reservedTickets - 1} places <button class=\\\"release\\\" data-id=\\\"${item._id}\\\">Annuler la réservation</button>`; \r\n    const releaseButton = listItem.querySelector('.release');\r\n    releaseButton.addEventListener('click', async () => {\r\n      await releaseItem(itemId, releaseButton);\r\n    });\r\n  } \r\n  await displayItems();\r\n   \r\n};\r\n\r\nconst getUser = async () => {\r\n  const requestOptions = {\r\n    method: 'GET',\r\n  };\r\n  const response = await fetch('/user/me', requestOptions);\r\n  if (!response.ok) {\r\n    throw new Error('Failed to get user.');\r\n  }\r\n  const user = await response.json();\r\n  userDiv.textContent = `${user.name}` || '';\r\n\r\n  borrowedItemDiv.innerHTML = '';\r\n  user.tickets.forEach(ticket => {\r\n    let listItem = document.createElement('li');\r\n    listItem.setAttribute('data-id', ticket.item._id);\r\n    listItem.innerHTML = `${ticket.item.description || 'Description non disponible'} : ${ticket.reservedTickets} places <button class=\"release\" data-id=\"${ticket.item._id}\">Annuler la réservation</button>`; \r\n    borrowedItemDiv.appendChild(listItem);\r\n\r\n    const releaseButton = listItem.querySelector('.release');\r\n    releaseButton.addEventListener('click', async () => {\r\n      await releaseItem(ticket.item._id, releaseButton);\r\n    });\r\n  });\r\n\r\n  return user;\r\n};\r\n\r\nconst logout = async () => {\r\n  const requestOptions = {\r\n                         method :'GET',\r\n                       };\r\n  const response = await fetch(`/access/logout`, requestOptions);\r\n  if (response.ok) {\r\n    window.location.href= '/access/login';\r\n  }\r\n};\r\n\r\nlog.addEventListener('click',logout);\r\ngetUser();\r\ndisplayItems();\r\nsocket.on('itemDeleted', (itemId) => {\r\n  contentDiv.textContent = `Spectacle avec id ${itemId} a été supprimé.`;\r\n  borrowedItemDiv.innerHTML = '';\r\n  displayItems(); \r\n});\r\nsocket.on('itemCreated', (itemId) => {\r\n  contentDiv.textContent = `Spectacle avec id ${itemId._id} a été créé.`;\r\n  displayItems();\r\n});\r\nsocket.on('itemModified', async (item) => {\r\n  contentDiv.textContent = `Spectacle avec id ${item._id} a été mis à jour.`;\r\n  const user = await getUser();\r\n  const ticket = user.tickets.find(ticket => ticket.item._id === item._id);\r\n  if (ticket) {\r\n    const listItem = borrowedItemDiv.querySelector(`li[data-id=\\\"${item._id}\\\"]`);\r\n    listItem.innerHTML = `${item.description || 'Description non disponible'} : ${ticket.reservedTickets} places <button class=\"release\" data-id=\"${item._id}\">Annuler la réservation</button>`;\r\n    const releaseButton = listItem.querySelector('.release');\r\n    releaseButton.addEventListener('click', async () => {\r\n      await releaseItem(item._id, releaseButton);\r\n    });\r\n  }\r\n  displayItems();\r\n});\r\n\r\nsocket.on('itemBorrowed', (itemId) => {\r\n  contentDiv.textContent = `Spectacle avec id ${itemId} est réservé.`;\r\n  displayItems();\r\n});\r\n\r\nsocket.on('itemReleased', (itemId) => {\r\n  contentDiv.textContent = `Spectacle avec id ${itemId} est libéré .`;\r\n  displayItems();\r\n});\r\n\r\nsocket.on('capacityZero', (itemId) => {\r\n  displayItems();\r\n});"],"names":["socket","io","contentDiv","document","getElementById","listDiv","userDiv","log","borrowedItemDiv","displayItems","requestOptions","method","response","fetch","ok","Error","items","json","html","forEach","item","description","capacity","_id","innerHTML","borrowButtons","querySelectorAll","button","addEventListener","itemId","getAttribute","borrowItem","user","getUser","ticket","tickets","find","toString","reservedTickets","disabled","textContent","emit","parentNode","remove","releaseItem","console","error","listItem","querySelector","releaseButton","name","createElement","setAttribute","appendChild","logout","window","location","href","on"],"sourceRoot":""}